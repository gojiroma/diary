<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Old+Mincho&display=swap" rel="stylesheet">

    <title>èª¤å­—ãƒ­ãƒã®æ—¥è¨˜</title>
    <link rel="icon" href="diary-icon.png" type="image/png">
    <style>
        :root {
            --bg-color: #e6f3ff;
            --text-color: #003366;
            --border-color: #003366;
            --timeline-color: #003366;
            --highlight-color: #ffeb3b;
        }

        body {
            font-family: "Zen Old Mincho", serif;
            font-weight: 400;
            font-style: normal;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            min-height: 100svh;
            margin: 0;
            padding: 0;
            overflow: hidden;
            position: relative;
            opacity: 0;
            transition: opacity 0.2s ease, background-color 0.2s ease;
            background-color: var(--bg-color);
        }

        body.fake-mode {
            --bg-color: #000;
            --text-color: #dadada;
            --border-color: #fff;
            --timeline-color: #fff;
            --highlight-color: #ffc107;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .page-title {
            color: var(--text-color);
            position: fixed;
            top: 10px;
            right: 20px;
            font-family: "Zen Old Mincho", serif;
            font-size: 18px;
            font-weight: 700;
            border: 1px solid var(--border-color);
            padding: 5px 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.1s;
            text-decoration: none;
            opacity: 0.2;
            z-index: 10;
            user-select: none;
        }

        #page-title-inmodal {
            color: var(--text-color);
            font-family: "Zen Old Mincho", serif;
            display: inline-block;
            font-size: 18px;
            font-weight: 700;
            border: 1px solid var(--border-color);
            padding: 5px 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.1s;
            text-decoration: none;
            z-index: 10;
            user-select: none;
            width: fit-content;
        }

        .page-title:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        .page-title.fake-mode {
            background-color: var(--bg-color);
            color: var(--text-color);
            border-color: var(--border-color);
        }

        .page-title.flash {
            background-color: #000 !important;
            color: #ff0 !important;
            border-color: #ff0 !important;
        }

        input[type="text"] {
            color: var(--text-color) !important;
            font-family: "Zen Old Mincho", serif;
            position: fixed;
            top: 10px;
            left: 20px;
            padding: 5px 10px;
            border-radius: 8px;
            width: 7ic;
            background-color: var(--bg-color);
            font-family: "Zen Old Mincho", serif;
            font-size: 18px;
            font-weight: 700;
            border: 1px solid var(--border-color);
            padding: 5px 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.1s;
            text-decoration: none;
            opacity: .1;
            z-index: 10;
            user-select: none;
            outline: none;
        }
        input[type="text"]:hover {
            opacity: 1;
        }

        ::placeholder {
            color: var(--text-color);
            opacity: .7;
        }

        .fake-mode ::placeholder {
            color: var(--text-color);
            opacity: .7;
        }

        .fake-mode .search-box,
        .fake-mode input[type="text"] {
            color: var(--text-color);
            background-color: var(--bg-color);
            border-color: var(--border-color);
        }

        .diary-container-wrapper {
            width: 100%;
            max-width: 90%;
            height: 78vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            box-sizing: border-box;
            margin-top: 20px;
            transition: background-color 0.2s ease;
            background-color: var(--bg-color);
        }

        .diary-container {
            display: flex;
            flex-direction: row;
            gap: 20px;
            width: 100%;
            height: 100%;
            padding: 0;
            overflow-x: auto;
            scrollbar-width: none;
        }

        ::-webkit-scrollbar {
            display: none;
        }

        .diary-entry {
            writing-mode: vertical-rl;
            text-orientation: upright;
            line-height: 2;
            letter-spacing: 0.1em;
            width: auto;
            white-space: normal;
            overflow: visible;
            scroll-margin-top: 50px;
            padding: 0 10px;
            transition: all 0.3s ease;
            flex-shrink: 0;
            text-wrap: balance;
            overflow-wrap: break-word;
            background-color: transparent;
            position: relative;
        }

        .date-container {
            display: flex;
            flex-direction: row;
            align-items: center;
            margin-right: 20px;
            margin-left: 20px;
            flex-wrap: wrap;
            gap: 5px;
        }

        .date {
            font-family: "Zen Old Mincho", serif;
            font-size: 1.6em;
            cursor: pointer;
            color: var(--text-color);
            white-space: nowrap;
        }

        .days-ago {
            font-family: "Zen Old Mincho", serif;
            font-size: 0.8em;
            color: var(--text-color);
            margin-left: 8px;
            white-space: nowrap;
            opacity: 0.3;
        }

        .content {
            font-family: "Zen Old Mincho", serif;
            font-size: 1.3em;
            white-space: pre-line;
            text-wrap: balance;
            overflow-wrap: break-word;
            color: var(--text-color);
        }

        .highlight {
            background-color: var(--highlight-color);
            font-weight: bold;
            padding: 0 2px;
            border-radius: 2px;
            margin: 0 -2px;
        }

        .timeline-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            padding: 0 10%;
            box-sizing: border-box;
            touch-action: none;
        }

        @media (max-width: 768px) {
            .timeline-container {
                height: 20px;
            }
        }

        .timeline {
            position: relative;
            display: flex;
            flex-direction: row-reverse;
            justify-content: center;
            align-items: flex-end;
            height: 100%;
            width: 100%;
            opacity: 0.1;
            transition: opacity 0.2s;
        }

        .timeline:hover {
            opacity: 1;
        }

        .timeline-bar {
            width: 6px;
            height: 100%;
            margin: 0 1px;
            background-color: transparent;
            cursor: pointer;
            display: flex;
            align-items: flex-end;
        }

        .timeline-bar-inner {
            width: 100%;
            background-color: var(--text-color);
            transition: background-color 0.2s;
        }

        .timeline-bar:hover .timeline-bar-inner,
        .timeline-bar.selected .timeline-bar-inner {
            background-color: #00bc84 !important;
            opacity: 1 !important;
        }

        @keyframes lanternOutline {
            0% {
                outline-color: #ff0000;
            }

            25% {
                outline-color: #00ff00;
            }

            50% {
                outline-color: #0000ff;
            }

            75% {
                outline-color: #ffff00;
            }

            100% {
                outline-color: #ff00ff;
            }
        }

        .search-box.lantern-mode {
            outline: 2px solid transparent;
            animation: lanternOutline 4s linear infinite;
        }

        @keyframes lanternBackground {
            0% {
                background-color: rgba(255, 0, 0, 0.2);
            }

            25% {
                background-color: rgba(0, 255, 0, 0.2);
            }

            50% {
                background-color: rgba(0, 0, 255, 0.2);
            }

            75% {
                background-color: rgba(255, 255, 0, 0.2);
            }

            100% {
                background-color: rgba(255, 0, 255, 0.2);
            }
        }

        @keyframes lanternText {
            0% {
                color: #ff0000;
            }

            25% {
                color: #00ff00;
            }

            50% {
                color: #0000ff;
            }

            75% {
                color: #ffff00;
            }

            100% {
                color: #ff00ff;
            }
        }

        .search-box.lantern-mode {
            outline: 2px solid transparent;
            animation: lanternOutline 4s linear infinite, lanternBackground 4s linear infinite, lanternText 4s linear infinite;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.7);
        }

        /* ã‚¢ã‚¤ã‚³ãƒ³ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .icon {
            width: 34px;
            height: 34px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: relative;
            transition: transform 0.1s, background-color 0.2s, filter 0.2s;
            border-radius: 4px;
        }

        .icon:hover {
            transform: scale(1.1);
            z-index: 20;
        }

        .icon.highlight {
            background-color: var(--highlight-color);
            filter: brightness(0.85);
        }

        .icon img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 4px;
        }

        span.icon-emoji,
        img.icon-img {
            font-size: x-large;
            filter: grayscale(84%);
            opacity: 0.4;
        }

        span.icon-emoji:hover,
        img.icon-img:hover {
            filter: grayscale(0%);
            opacity: 1;
        }

        /* ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .tooltip {
            position: absolute;
            top: -50%;
            left: 140%;
            transform: translateX(-50%);
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            border: 1px solid var(--border-color);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 30;
            margin-bottom: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-family: "Zen Old Mincho", serif;
        }

        .icon:hover .tooltip {
            opacity: 1;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .info-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background-color: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 100;
            font-size: 18px;
            transition: all 0.2s;
            user-select: none;
            opacity: 0.3;
        }

        .info-button:hover {
            transform: scale(1.1);
            opacity: 0.8;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: skewY(-3deg);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ */
        .modal-overlay {
            opacity: 0;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            visibility: hidden;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            transform: skewY(-3deg) translateY(20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .modal-overlay.show .modal-content {
            transform: skewY(-3deg) translateY(0);
            opacity: 1;
        }

        .modal-inner {
            transform: skewY(3deg);
        }

        .modal-content h1 {
            font-size: 1.8em;
            margin-top: 0;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            transform: skewY(-3deg);

        }

        .modal-content h2 {
            font-size: 1.3em;
            margin-top: 20px;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 5px;
            transform: skewY(-3deg);

        }

        .modal-content p {
            line-height: 1.6;
            margin: 10px 0;
            transform: skewY(-3deg);
        }

        .modal-content input[type="text"] {
            position: static;
            width: 150px;
            margin: 0 5px;
            opacity: 1;
            border: none;
            border-bottom: 1px solid var(--border-color);
            background-color: transparent;
            font-size: 1em;
            padding: 5px;
        }

        .modal-content textarea {
            width: 100%;
            height: 100px;
            margin: 10px 0;
            padding: 3px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.1);
            font-family: "Zen Old Mincho", serif;
            resize: vertical;
            transform: skewY(-3deg);

        }

        .modal-content img {
            display: block;
            margin: 15px auto;
            transform: skewY(-3deg);

        }

        .qr {
            max-width: 150px;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            transform: skewY(-3deg);
        }

        .modal-button {
            background-color: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            margin: 0 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-button:hover {
            opacity: 0.8;
        }

        .share-button {
            background-color: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 15px auto;
            display: block;
            transition: all 0.2s;
            transform: skewY(-3deg);

        }

        .share-button:hover {
            opacity: 0.8;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-color);
        }
    </style>
</head>

<body>
    <input type="text" class="search-box" placeholder="æ¤œç´¢oräºŒåº¦æŠ¼ã—">
    <div class="page-title" id="pageTitle">èª¤å­—ãƒ­ãƒã®æ—¥è¨˜</div>
    <div class="diary-container-wrapper">
        <div class="diary-container" id="diaryContainer"></div>
    </div>
    <div class="timeline-container">
        <div class="timeline" id="timeline"></div>
    </div>
    <div class="info-button" id="infoButton">i</div>
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <button class="close-button" id="closeButton">&times;</button>
            <div class="modal-inner">
                <h1>èª¤å­—ãƒ­ãƒã®æ—¥è¨˜</h1>

                <h2>ãªã‚“ã ã€ã“ã®æ—¥è¨˜ã¯ï¼Ÿ</h2>
                <p>ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ—¥è¨˜ã¯ã€åŒ—é–¢æ±ã®æŸæ‰€ã§ç”Ÿãã‚‹ã²ã¨ã‚Šã®äººé–“ãŒã€ãã®æ—¥ã®å‡ºæ¥äº‹ã‚„æ€ã£ãŸã“ã¨ã‚’æ°—è»½ã«ã€ã‹ã¤ç„¡è²¬ä»»ã«æ›¸ãç¶šã‘ã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚</p>
                <p>ç”»é¢å³ä¸Šã®<span
                        id="page-title-inmodal">èª¤å­—ãƒ­ãƒã®æ—¥è¨˜</span>ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ç”»é¢ãŒæš—è»¢ã—ã€ã€Œå˜˜æ—¥è¨˜ã€ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚ã“ã“ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹å›ºæœ‰åè©ã¯ã€å®Ÿåœ¨ã™ã‚‹ã‚‚ã®ã¨å…¨ãé–¢ä¿‚ãŒã‚ã‚Šã¾ã›ã‚“ã®ã§ã”ç•™æ„ãã ã•ã„ã€‚å†åº¦ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€Œæœ¬å½“æ—¥è¨˜ã€ã®è¡¨ç¤ºã«æˆ»ã‚Šã¾ã™ã€‚ãŸã ã—ã€æœ¬å½“ã®æ—¥è¨˜ã‚‚å¿…ãšã—ã‚‚äº‹å®ŸãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ä¿è¨¼ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ç­†è€…ã®èªè­˜ãŒã‚†ãŒã‚“ã§ã„ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚ã™ã¹ã¦ã€ã‚ãã¾ã§å¨¯æ¥½ã¨ã—ã¦ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
                </p>
                <p>ç”»é¢å·¦ä¸Šã®ç®±ã«ã¯ã€å¥½ããªè¨€è‘‰ã‚’å…¥ã‚Œã¦ã„ãŸã ãã¨ã€æ—¥è¨˜ã®å†…å®¹ã‚’çµã‚Šè¾¼ã‚“ã§è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ç®±ã‚’äºŒåº¦æŠ¼ã—ã™ã‚‹ã¨ã€é©å½“ãªè¨€è‘‰ã‚’å…¥ã‚Œæ›¿ãˆãªãŒã‚‰è¡¨ç¤ºã—ã¾ã™ã€‚</p>

                <h2>ãŠãŸã‚ˆã‚Š</h2>
                <p>æ—¥è¨˜ã®æ„Ÿæƒ³ã€è‡ªåˆ†èªã‚Šã€å°¿æ¼ã‚Œã®ãŠæ‚©ã¿ãªã©ã€<input type="text" id="mailSubject"
                        placeholder="ãŠå¥½ããªè‹±æ•°å­—">@poet.blueã¾ã§ã€æ°—è»½ã«ãŠé€ã‚Šãã ã•ã„ã€‚ãªãŠã€ãƒ¡ãƒ¼ãƒ«ã¸ã®è¿”ä¿¡ã¯æ°—åˆ†æ¬¡ç¬¬ã§ã™ã€‚ã”äº†æ‰¿ãã ã•ã„ã€‚å ´åˆã«ã‚ˆã£ã¦ã¯æ—¥è¨˜ã®æ—¥ä»˜ä¸‹éƒ¨ã«ã€ŒğŸ“®ã€ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¨­ç½®ã—ã€ãŠè¿”äº‹ãƒšãƒ¼ã‚¸ã®æ²è¼‰ã‚’ã‚‚ã£ã¦ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã™ã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚
                </p>
                <textarea id="mailBody" placeholder="ä¾‹:â—‹æœˆÃ—æ—¥ã®ã€ã€‡ã€‡ã€ã¨ã„ã†éƒ¨åˆ†ã‚’èª­ã‚“ã§ã€â–³â–³ã‚’æ€ã„å‡ºã—ã¾ã—ãŸã€‚"></textarea>
                <div class="modal-buttons">
                    <button class="modal-button" id="sendMailButton">é€ã‚‹ä¸€æ­©æ‰‹å‰</button>
                </div>

                <h2>çŸ¥äººã«çŸ¥ã‚‰ã›ã‚‹</h2>
                <p>æ°—åˆ†ãŒãµã•ãŒã£ã¦ã„ã‚‹ã€æš‡ã‚’æŒã¦ä½™ã—ã¦ã„ã‚‹ã€ä½•ã‹ç„¡æ–™ã§èª­ã¿ãŸã„ã¨ã„ã†æ–¹ãŒã„ã‚‰ã£ã—ã‚ƒã„ã¾ã—ãŸã‚‰ã€ã“ã®æ—¥è¨˜ã‚’ã”ç´¹ä»‹ãã ã•ã„ã€‚</p>
                <img src="https://i.imgur.com/BxnlTB4.png" alt="QRã‚³ãƒ¼ãƒ‰" class="qr">
                <center>
                    <p>https://nikki.poet.blue</p>
                </center>
                <button class="share-button" id="shareButton">å…±æœ‰ã™ã‚‹</button>

                <h2>Buy me a pen</h2>
                <p>ä»Šæ—¥ã¯çã—ãé¢ç™½ã‹ã£ãŸï¼ã¨ã‹ã€ãªã‚“ã‹æ©Ÿå«ŒãŒè‰¯ã‹ã£ãŸã€ã¨ã„ã†æ—¥ã«ãœã²ï¼
                </p>
                <a href="https://www.buymeacoffee.com/gojiroma" target="_blank" class="noskew"><img
                        src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee"
                        style="height: 60px !important;width: 217px !important;"></a>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let audioContext = null;

        // ãƒ“ãƒ¼ãƒ—éŸ³ã‚’å†ç”Ÿã™ã‚‹é–¢æ•°
        async function playBeep(frequency = 440, duration = 0.1) {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå¾Œã«å†ç”Ÿã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
                await audioContext.resume();
            } else if (audioContext.state === 'suspended') {
                await audioContext.resume();
            }

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.type = 'sine';
            oscillator.frequency.value = frequency;
            gainNode.gain.value = 0.1;
            gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + duration);

            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration);
        }

        // ===== Utilities =====
        class DiaryUtils {
            static toKanjiNumber(num) {
                const kanjiNumbers = ['ã€‡', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä¸ƒ', 'å…«', 'ä¹'];
                return num.toString().split('').map(digit => kanjiNumbers[digit]).join('');
            }

            static toKanjiMonth(month) {
                const kanjiMonths = [
                    'ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ',
                    'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'åä¸€æœˆ', 'åäºŒæœˆ'
                ];
                return kanjiMonths[month - 1];
            }

            static toKanjiDay(day) {
                if (day === 10) return 'å';
                if (day === 20) return 'äºŒå';
                if (day === 30) return 'ä¸‰å';
                if (day === 31) return 'ä¸‰åä¸€';
                if (day < 10) return this.toKanjiNumber(day);
                if (day < 20) return 'å' + this.toKanjiNumber(day - 10);
                if (day < 30) return 'äºŒå' + this.toKanjiNumber(day - 20);
                return this.toKanjiNumber(day);
            }

            static toJapaneseEra(year) {
                if (year >= 2019) {
                    const eraYear = year - 2018;
                    return `ä»¤å’Œ${this.toKanjiNumber(eraYear)}å¹´`;
                } else if (year >= 1989) {
                    const eraYear = year - 1988;
                    return `å¹³æˆ${this.toKanjiNumber(eraYear)}å¹´`;
                } else if (year >= 1926) {
                    const eraYear = year - 1925;
                    return `æ˜­å’Œ${this.toKanjiNumber(eraYear)}å¹´`;
                } else if (year >= 1912) {
                    const eraYear = year - 1911;
                    return `å¤§æ­£${this.toKanjiNumber(eraYear)}å¹´`;
                } else {
                    const eraYear = year - 1867;
                    return `æ˜æ²»${this.toKanjiNumber(eraYear)}å¹´`;
                }
            }

            static formatJapaneseDate(yyyymmdd) {
                const year = parseInt(yyyymmdd.substring(0, 4), 10);
                const month = parseInt(yyyymmdd.substring(4, 6), 10);
                const day = parseInt(yyyymmdd.substring(6, 8), 10);
                const date = new Date(year, month - 1, day);
                const dayOfWeek = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][date.getDay()];
                return {
                    short: `${this.toKanjiMonth(month)}${this.toKanjiDay(day)}æ—¥ï¼ˆ${DiaryApp.isFakeMode ? 'å˜˜' : dayOfWeek}ï¼‰`,
                    long: `${this.toJapaneseEra(year)}${this.toKanjiMonth(month)}${this.toKanjiDay(day)}æ—¥ï¼ˆ${DiaryApp.isFakeMode ? 'å˜˜' : dayOfWeek}ï¼‰`
                };
            }

            static generateRandomDate() {
                const today = new Date();
                const randomDaysAgo = Math.floor(Math.random() * 60) + 1;
                const randomDate = new Date(today);
                randomDate.setDate(today.getDate() - randomDaysAgo);
                const year = randomDate.getFullYear();
                const month = String(randomDate.getMonth() + 1).padStart(2, '0');
                const day = String(randomDate.getDate()).padStart(2, '0');
                return `${year}${month}${day}`;
            }

            static calculateDaysAgo(yyyymmdd) {
                const year = parseInt(yyyymmdd.substring(0, 4), 10);
                const month = parseInt(yyyymmdd.substring(4, 6), 10) - 1;
                const day = parseInt(yyyymmdd.substring(6, 8), 10);
                const entryDate = new Date(year, month, day);
                const today = new Date();
                const diffTime = today - entryDate;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                return diffDays === 0 ? 'ä»Šæ—¥' : `${diffDays}æ—¥å‰`;
            }

            static escapeRegExp(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }

            static highlightText(text, keyword) {
                if (!keyword.trim()) return text;
                const regex = new RegExp(this.escapeRegExp(keyword), 'gi');
                return text.replace(regex, match => `<span class="highlight">${match}</span>`);
            }
        }

        // ===== App Class =====
        class DiaryApp {
            static THEMES = [
                { bg: "#e6f3ff", text: "#003366", border: "#003366" },
                { bg: "#fff8e6", text: "#8b4513", border: "#8b4513" },
                { bg: "#e6ffe6", text: "#2e8b57", border: "#2e8b57" },
                { bg: "#ffe6f0", text: "#8b008b", border: "#8b008b" },
                { bg: "#f0f0ff", text: "#4b0082", border: "#4b0082" },
                { bg: "#ffffe6", text: "#b8860b", border: "#b8860b" },
                { bg: "#e6ffff", text: "#0066cc", border: "#0066cc" },
                { bg: "#f0e6ff", text: "#800080", border: "#800080" },
                { bg: "#fff0e6", text: "#cd5c5c", border: "#cd5c5c" },
                { bg: "#f0ffe6", text: "#228b22", border: "#228b22" }
            ];

            static currentTheme = null;
            static isFakeMode = false;
            static fakeEntriesCache = null;
            static diaryEntries = [];
            static eventListeners = [];
            static currentSearchKeyword = '';
            static iconsData = [];
            static isLanternMode = false;
            static lanternModeInterval = null;

            static init() {
                this.applyRandomTheme();
                this.loadIconsData();
                this.loadDiaryEntries();
                this.preloadFakeEntries();
                this.setupEventListeners();
                this.setupModal();
                document.body.style.opacity = 1;
            }

            static applyRandomTheme() {
                const randomTheme = this.THEMES[Math.floor(Math.random() * this.THEMES.length)];
                this.currentTheme = randomTheme;
                document.documentElement.style.setProperty('--bg-color', randomTheme.bg);
                document.documentElement.style.setProperty('--text-color', randomTheme.text);
                document.documentElement.style.setProperty('--border-color', randomTheme.border);
            }

            static async loadIconsData() {
                try {
                    const response = await fetch('icons.csv');
                    if (!response.ok) {
                        console.error(`Failed to load icons.csv: ${response.status} ${response.statusText}`);
                        return;
                    }
                    const csv = await response.text();
                    this.iconsData = this.parseCSV(csv);
                } catch (error) {
                    console.error('Error loading icons.csv:', error);
                }
            }

            static parseCSV(csv) {
                const lines = csv.split('\n').filter(line => line.trim());
                const headers = ['date', 'title', 'icon', 'url'];
                return lines.slice(1).map(line => {
                    const values = line.split(',').map(v => v.trim());
                    return headers.reduce((obj, header, i) => {
                        obj[header] = values[i] || '';
                        return obj;
                    }, {});
                });
            }

            static getIconsForDate(dateForIcons, keyword = '') {
                const icons = this.iconsData.filter(icon => icon.date === dateForIcons);
                if (icons.length === 0) return '';

                return icons.map(icon => {
                    const isUrl = icon.icon && (icon.icon.startsWith('http://') || icon.icon.startsWith('https://'));
                    const iconContent = isUrl
                        ? `<img src="${icon.icon}" alt="${icon.title}" class="icon-img" loading="lazy">`
                        : `<span class="icon-emoji">${icon.icon}</span>`;
                    const tooltip = icon.title ? `<div class="tooltip">${icon.title}</div>` : '';
                    const url = icon.url ? `onclick="window.open('${icon.url}', '_blank')" style="cursor: pointer;"` : '';
                    const highlightClass = keyword && icon.title.toLowerCase().includes(keyword.toLowerCase()) ? 'highlight' : '';
                    return `<div class="icon ${highlightClass}" ${url}>${iconContent}${tooltip}</div>`;
                }).join('');
            }

            static executeLanternSearch() {
                if (this.diaryEntries.length === 0) return;

                const randomEntry = this.diaryEntries[Math.floor(Math.random() * this.diaryEntries.length)];
                const content = randomEntry.content;

                if (content.length < 2) return;
                const startIndex = Math.floor(Math.random() * (content.length - 2));
                const keywordLength = 2 + Math.floor(Math.random() * 2);
                let keyword = content.substring(startIndex, startIndex + keywordLength);

                const searchBox = document.querySelector('.search-box');
                searchBox.value = keyword;
                this.handleSearch(keyword);
            }

            static stopLanternMode() {
                if (!this.isLanternMode) return;
                this.isLanternMode = false;

                if (this.lanternModeInterval) {
                    clearInterval(this.lanternModeInterval);
                    this.lanternModeInterval = null;
                }

                const searchBox = document.querySelector('.search-box');
                searchBox.value = '';
                this.handleSearch('');
                searchBox.classList.remove('lantern-mode');
            }

            static startLanternMode() {
                if (this.isLanternMode) return;
                this.isLanternMode = true;

                const searchBox = document.querySelector('.search-box');
                searchBox.blur();
                searchBox.classList.add('lantern-mode');

                this.executeLanternSearch();
                this.lanternModeInterval = setInterval(() => {
                    this.executeLanternSearch();
                }, 3000);
            }

            static setupEventListeners() {
                const pageTitle = document.getElementById('pageTitle');
                const searchBox = document.querySelector('.search-box');
                const infoButton = document.getElementById('infoButton');


                pageTitle.addEventListener('click', () => {
                    playBeep(220, 0.1); // ä½ã„éŸ³
                    this.toggleFakeMode();
                });
                let pressTimer;
                pageTitle.addEventListener('mousedown', () => {
                    pressTimer = setTimeout(() => this.downloadDiaryAsText(), 1000);
                });
                pageTitle.addEventListener('mouseup', () => clearTimeout(pressTimer));
                pageTitle.addEventListener('mouseleave', () => clearTimeout(pressTimer));

                searchBox.addEventListener('input', (e) => this.handleSearch(e.target.value));

                document.addEventListener('keydown', (e) => this.handleKeyDown(e));

                window.addEventListener('hashchange', () => this.scrollToEntryFromHash());

                window.addEventListener('load', () => this.scrollToEntryFromHash());

                searchBox.addEventListener('dblclick', () => {
                    this.startLanternMode();
                });

                searchBox.addEventListener('click', () => {
                    playBeep(850, 0.1); // ä¸­ãã‚‰ã„ã®éŸ³
                    if (searchBox.value) {
                        searchBox.value = '';
                        this.handleSearch('');
                    }
                    this.stopLanternMode();
                });


                searchBox.addEventListener('focus', () => {
                    if (searchBox.value) {
                        searchBox.value = '';
                        this.handleSearch('');
                    }
                    this.stopLanternMode();
                });
                infoButton.addEventListener('click', () => {
                    playBeep(770, 0.1); // é«˜ã„éŸ³
                });

            }

            static setupModal() {
                const infoButton = document.getElementById('infoButton');
                const modalOverlay = document.getElementById('modalOverlay');
                const closeButton = document.getElementById('closeButton');
                const sendMailButton = document.getElementById('sendMailButton');
                const shareButton = document.getElementById('shareButton');

                // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºæ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                infoButton.addEventListener('click', () => {
                    modalOverlay.style.display = 'flex';
                    setTimeout(() => modalOverlay.classList.add('show'), 10);
                });

                // ãƒ¢ãƒ¼ãƒ€ãƒ«éè¡¨ç¤ºæ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                closeButton.addEventListener('click', () => {
                    modalOverlay.classList.remove('show');
                    setTimeout(() => modalOverlay.style.display = 'none', 300);
                });

                modalOverlay.addEventListener('click', (e) => {
                    if (e.target === modalOverlay) {
                        modalOverlay.classList.remove('show');
                        setTimeout(() => modalOverlay.style.display = 'none', 300);
                    }
                });

                sendMailButton.addEventListener('click', () => {
                    const subject = document.getElementById('mailSubject').value || 'somebody';
                    const body = document.getElementById('mailBody').value || 'æœ¬æ–‡ãªã—';
                    const mailtoLink = `mailto:${subject}@poet.blue?subject=èª¤å­—ãƒ­ãƒã®æ—¥è¨˜ã‚’èª­ã¿ã¾ã—ãŸ&body=${encodeURIComponent(body)}`;
                    window.location.href = mailtoLink;
                });

                shareButton.addEventListener('click', () => {
                    if (navigator.share) {
                        navigator.share({
                            title: 'èª¤å­—ãƒ­ãƒã®æ—¥è¨˜',
                            url: 'https://nikki.poet.blue'
                        }).catch(err => {
                            console.log('å…±æœ‰ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
                        });
                    } else {
                        alert('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯å…±æœ‰æ©Ÿèƒ½ãŒä½¿ãˆã¾ã›ã‚“ã€‚URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„: https://nikki.poet.blue');
                    }
                });
            }

            static async loadDiaryEntries(filename = 'entry.md') {
                try {
                    const response = await fetch(filename);
                    if (!response.ok) {
                        console.error(`Failed to load ${filename}: ${response.status} ${response.statusText}`);
                        return;
                    }
                    const text = await response.text();
                    this.renderEntries(text);
                } catch (error) {
                    console.error(`Error loading ${filename}:`, error);
                }
            }

            static renderEntries(text) {
                const container = document.getElementById('diaryContainer');
                container.innerHTML = '';
                this.diaryEntries = [];

                const entries = text.split('---').filter(entry => entry.trim());
                entries.reverse().forEach(entry => {
                    const dateMatch = entry.match(/date:\s*(.*)/);
                    const contentMatch = entry.match(/content:\s*\|\n([\s\S]*?)(?=\n---|\n$)/m);
                    if (!dateMatch || !contentMatch) return;

                    const yyyymmdd = dateMatch[1].trim();
                    const dateObj = DiaryUtils.formatJapaneseDate(yyyymmdd);
                    let contentLines = contentMatch[1]
                        .split('\n')
                        .map(line => line.replace(/^\s*\|?\s*/, ''))
                        .join('\n')
                        .trim();

                    if (this.currentSearchKeyword) {
                        contentLines = DiaryUtils.highlightText(contentLines, this.currentSearchKeyword);
                    }

                    const entryElement = document.createElement('div');
                    entryElement.className = 'diary-entry';
                    entryElement.id = yyyymmdd;

                    const dateForIcons = `${yyyymmdd.substring(0, 4)}/${yyyymmdd.substring(4, 6)}/${yyyymmdd.substring(6, 8)}`;
                    const iconsHTML = this.getIconsForDate(dateForIcons, this.currentSearchKeyword);

                    entryElement.innerHTML = `
                        <div class="date-container">
                            <div class="date" data-yyyymmdd="${yyyymmdd}">${dateObj.short}</div>
                            <div class="days-ago">${DiaryUtils.calculateDaysAgo(yyyymmdd)}</div>
                            ${iconsHTML}
                        </div>
                        <div class="content">${contentLines}</div>
                    `;
                    container.appendChild(entryElement);

                    this.diaryEntries.push({
                        yyyymmdd,
                        content: contentMatch[1].split('\n').map(line => line.replace(/^\s*\|?\s*/, '')).join('\n').trim(),
                        icons: this.iconsData.filter(icon => icon.date === dateForIcons)
                    });
                });

                this.setupDateClick();
                this.renderTimeline();
                this.updatePageTitle(entries.length);
                this.scrollToEntryFromHash();
            }

            static setupDateClick() {
                document.querySelectorAll('.date').forEach(dateElement => {
                    dateElement.addEventListener('click', () => {
                        const yyyymmdd = dateElement.getAttribute('data-yyyymmdd');
                        window.location.hash = yyyymmdd;
                        this.flashEntry(document.getElementById(yyyymmdd));
                    });
                });
            }

            static renderTimeline() {
                const timeline = document.getElementById('timeline');
                timeline.innerHTML = '';

                if (this.diaryEntries.length === 0) return;

                const sortedEntries = [...this.diaryEntries].sort((a, b) => a.yyyymmdd.localeCompare(b.yyyymmdd));
                const contentLengths = sortedEntries.map(entry => entry.content.length);
                const maxContentLength = Math.min(this.percentile95(contentLengths), 500);
                const baseHeight = 5;
                const heightRatio = 45 / maxContentLength;

                sortedEntries.forEach(entry => {
                    const container = document.createElement('div');
                    container.className = 'timeline-bar';
                    container.dataset.yyyymmdd = entry.yyyymmdd;

                    const innerBar = document.createElement('div');
                    innerBar.className = 'timeline-bar-inner';
                    const contentLength = Math.min(entry.content.length, maxContentLength);
                    const height = Math.max(baseHeight, contentLength * heightRatio);
                    innerBar.style.height = `${height}px`;

                    container.addEventListener('mouseover', () => {
                        window.location.hash = entry.yyyymmdd;
                        this.scrollToEntryFromHash();
                    });

                    container.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        window.location.hash = entry.yyyymmdd;
                        this.scrollToEntryFromHash();
                    });

                    container.appendChild(innerBar);
                    timeline.appendChild(container);
                });

                // åˆæœŸè¡¨ç¤ºæ™‚ã«hashãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€selectedã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                const hash = window.location.hash.substring(1);
                if (hash && hash.match(/^\d{8}$/)) {
                    const selectedBar = document.querySelector(`.timeline-bar[data-yyyymmdd="${hash}"]`);
                    if (selectedBar) {
                        selectedBar.classList.add('selected');
                    }
                }

                timeline.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const rect = timeline.getBoundingClientRect();
                    const x = touch.clientX - rect.left;
                    const percent = x / rect.width;
                    const index = Math.floor((1 - percent) * sortedEntries.length);
                    if (index >= 0 && index < sortedEntries.length) {
                        window.location.hash = sortedEntries[index].yyyymmdd;
                        this.scrollToEntryFromHash();
                    }
                }, { passive: false });
            }

            static percentile95(arr) {
                const sorted = [...arr].sort((a, b) => a - b);
                const index = Math.floor(sorted.length * 0.95);
                return sorted[index];
            }

            static toggleFakeMode() {
                const title = document.querySelector('.page-title');
                const body = document.body;

                this.isFakeMode = !this.isFakeMode;
                title.textContent = this.isFakeMode ? 'èª¤å­—ãƒ­ãƒã®å˜˜æ—¥è¨˜' : 'èª¤å­—ãƒ­ãƒã®æ—¥è¨˜';
                title.classList.toggle('fake-mode', this.isFakeMode);
                body.classList.toggle('fake-mode', this.isFakeMode);

                if (this.isFakeMode) {
                    if (this.fakeEntriesCache) {
                        this.renderEntries(this.fakeEntriesCache);
                    } else {
                        this.loadDiaryEntries('fake.md');
                    }
                } else {
                    this.loadDiaryEntries('entry.md');
                }
            }

            static async preloadFakeEntries() {
                try {
                    const response = await fetch('fake.md');
                    if (response.ok) {
                        this.fakeEntriesCache = await response.text();
                    } else {
                        console.error(`Failed to preload fake.md: ${response.status} ${response.statusText}`);
                    }
                } catch (error) {
                    console.error('Error preloading fake entries:', error);
                }
            }

            static scrollToEntryFromHash() {
                playBeep(340, 0.1);
                requestAnimationFrame(() => {
                    const hash = window.location.hash.substring(1);
                    const container = document.getElementById('diaryContainer');
                    const entries = document.querySelectorAll('.diary-entry');
                    const timelineBars = document.querySelectorAll('.timeline-bar');

                    // æ—¢å­˜ã®selectedã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                    timelineBars.forEach(bar => bar.classList.remove('selected'));

                    if (hash && hash.match(/^\d{8}$/)) {
                        const entry = document.getElementById(hash);
                        if (entry) {
                            const entryRight = entry.offsetLeft + entry.clientWidth;
                            const containerWidth = container.clientWidth;
                            this.smoothScrollTo(container, entryRight - containerWidth);
                            this.flashEntry(entry);

                            // é¸æŠã•ã‚Œã¦ã„ã‚‹timeline-barã«selectedã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                            const selectedBar = document.querySelector(`.timeline-bar[data-yyyymmdd="${hash}"]`);
                            if (selectedBar) {
                                selectedBar.classList.add('selected');
                            }
                        }
                    } else if (entries.length > 0) {
                        const latestEntry = entries[0];
                        const entryRight = latestEntry.offsetLeft + latestEntry.clientWidth;
                        const containerWidth = container.clientWidth;
                        this.smoothScrollTo(container, entryRight - containerWidth);
                    }
                });
            }

            static smoothScrollTo(element, targetPosition, duration = 50) {
                const startPosition = element.scrollLeft;
                const startTime = performance.now();

                const animateScroll = (currentTime) => {
                    const elapsedTime = currentTime - startTime;
                    const progress = Math.min(elapsedTime / duration, 1);
                    element.scrollLeft = startPosition + (targetPosition - startPosition) * progress;

                    if (progress < 1) {
                        requestAnimationFrame(animateScroll);
                    }
                };

                requestAnimationFrame(animateScroll);
            }

            static flashEntry(entry) {
                document.querySelectorAll('.diary-entry').forEach(el => {
                    if (el !== entry) {
                        Object.assign(el.style, {
                            transition: 'none',
                            fontWeight: '',
                            filter: 'brightness(1)',
                            color: ''
                        });
                    }
                });

                Object.assign(entry.style, {
                    transition: 'filter 0.2s ease, color 0.2s ease',
                    color: this.isFakeMode ? '#fff' : '#333333',
                    filter: 'brightness(2)'
                });

                setTimeout(() => {
                    Object.assign(entry.style, {
                        color: this.isFakeMode ? '#fff' : this.currentTheme.text,
                        filter: 'brightness(1)'
                    });
                }, 1200);
            }

            static handleKeyDown(e) {
                if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                    e.preventDefault();
                    const currentEntry = this.getCurrentEntry();
                    if (!currentEntry) return;

                    const direction = e.key === 'ArrowLeft' ? -1 : 1;
                    const nextEntry = this.getAdjacentEntry(currentEntry, direction);
                    if (nextEntry) {
                        window.location.hash = nextEntry.id;
                        this.scrollToEntryFromHash();
                    }
                } else if (e.key === 'Escape') {
                    if (window.location.hash) {
                        window.location.hash = '';
                    }
                }
            }

            static getCurrentEntry() {
                const hash = window.location.hash.substring(1);
                if (hash && hash.match(/^\d{8}$/)) {
                    return document.getElementById(hash);
                }
                const entries = document.querySelectorAll('.diary-entry');
                return entries.length > 0 ? entries[0] : null;
            }

            static getAdjacentEntry(currentEntry, direction) {
                const entries = document.querySelectorAll('.diary-entry');
                const currentIndex = Array.from(entries).indexOf(currentEntry);
                if (currentIndex === -1) return null;

                const nextIndex = currentIndex + direction;
                if (nextIndex < 0 || nextIndex >= entries.length) return null;
                return entries[nextIndex];
            }

            static handleSearch(keyword) {
                this.currentSearchKeyword = keyword;
                const keywordLower = keyword.toLowerCase();

                document.querySelectorAll('.diary-entry').forEach(entry => {
                    const contentElement = entry.querySelector('.content');
                    const dateContainer = entry.querySelector('.date-container');
                    const entryData = this.diaryEntries.find(e => e.yyyymmdd === entry.id);
                    if (!entryData) return;

                    const originalContent = entryData.content;
                    const contentLower = originalContent.toLowerCase();

                    // iconã®titleã‚‚æ¤œç´¢å¯¾è±¡ã«è¿½åŠ 
                    const iconTitles = entryData.icons.map(icon => icon.title.toLowerCase());
                    const isMatch = contentLower.includes(keywordLower) ||
                        iconTitles.some(title => title.includes(keywordLower));

                    if (isMatch) {
                        entry.style.display = 'block';
                        if (keyword) {
                            contentElement.innerHTML = DiaryUtils.highlightText(originalContent, keyword);

                            // ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’æ›´æ–°
                            const yyyymmdd = entry.id;
                            const dateForIcons = `${yyyymmdd.substring(0, 4)}/${yyyymmdd.substring(4, 6)}/${yyyymmdd.substring(6, 8)}`;
                            const iconsHTML = this.getIconsForDate(dateForIcons, keyword);
                            const newDateContainer = document.createElement('div');
                            newDateContainer.className = 'date-container';
                            newDateContainer.innerHTML = `
                                <div class="date" data-yyyymmdd="${yyyymmdd}">${dateContainer.querySelector('.date').textContent}</div>
                                <div class="days-ago">${dateContainer.querySelector('.days-ago').textContent}</div>
                                ${iconsHTML}
                            `;
                            dateContainer.replaceWith(newDateContainer);
                        } else {
                            contentElement.textContent = originalContent;
                        }
                    } else {
                        entry.style.display = 'none';
                    }
                });
            }

            static downloadDiaryAsText() {
                if (this.diaryEntries.length === 0) {
                    alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ—¥è¨˜ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
                    return;
                }

                const sortedEntries = [...this.diaryEntries].sort((a, b) => a.yyyymmdd.localeCompare(b.yyyymmdd));
                const oldestDate = sortedEntries[0].yyyymmdd;
                const newestDate = sortedEntries[sortedEntries.length - 1].yyyymmdd;
                const modePrefix = this.isFakeMode ? 'å˜˜æ—¥è¨˜_' : '';
                const filename = `${modePrefix}èª¤å­—ãƒ­ãƒã®æ—¥è¨˜ ${oldestDate}-${newestDate}.txt`;

                let content = '';
                sortedEntries.forEach(entry => {
                    const dateObj = DiaryUtils.formatJapaneseDate(entry.yyyymmdd);
                    content += `${dateObj.long}\n${entry.content}\n\n`;
                });

                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            static updatePageTitle(count) {
                const pageTitle = document.getElementById('pageTitle');
                const pageInModalTitle = document.getElementById('page-title-inmodal');
                pageTitle.textContent = `èª¤å­—ãƒ­ãƒã®${count}æ—¥é–“`;
                pageInModalTitle.textContent = `èª¤å­—ãƒ­ãƒã®${count}æ—¥é–“`;
            }
        }

        // Initialize the app
        DiaryApp.init();
    </script>
</body>

</html>
