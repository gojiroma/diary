<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>誤字ロマの日記</title>
    <link rel="icon" href="diary-icon.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&family=M+PLUS+1p:wght@900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --accent-color: #bb86fc;
            --secondary-color: #03dac6;
            --error-color: #cf6679;
            --input-bg: #1e1e1e;
            --input-border: #333;
            --highlight-bg: #ffeb3b;
            --highlight-text: #000;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Kosugi Maru', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .terminal-header {
            background-color: #2d2d2d;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid var(--accent-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .terminal-dots {
            display: flex;
            gap: 6px;
        }

        .terminal-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot-red { background-color: #ff5f56; }
        .dot-yellow { background-color: #ffbd2e; }
        .dot-green { background-color: #27ca3f; }

        .terminal-title {
            margin-left: 15px;
            font-family: 'M PLUS 1p', sans-serif;
            font-weight: 900;
            color: var(--accent-color);
            letter-spacing: 1px;
        }

        .diary-container {
            flex: 1;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            min-height: calc(100vh - 120px);
        }

        .entry-card {
            background-color: #1e1e1e;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .entry-card.hidden {
            display: none;
        }

        .entry-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            border-color: var(--accent-color);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #333;
        }

        .entry-date {
            font-family: 'M PLUS 1p', sans-serif;
            font-weight: 900;
            color: var(--accent-color);
            font-size: 1.1rem;
        }

        .entry-content {
            white-space: pre-wrap;
            font-size: 1rem;
            line-height: 1.8;
        }

        .glitch-effect {
            position: relative;
        }

        .glitch-effect::before {
            content: attr(data-text);
            position: absolute;
            left: 2px;
            text-shadow: -1px 0 var(--secondary-color);
            clip: rect(24px, 550px, 90px, 0);
            animation: glitch 3s infinite linear alternate-reverse;
        }

        .glitch-effect::after {
            content: attr(data-text);
            position: absolute;
            left: -2px;
            text-shadow: 1px 0 var(--error-color);
            clip: rect(85px, 550px, 140px, 0);
            animation: glitch 2s infinite linear alternate-reverse;
        }

        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-3px, 3px); }
            40% { transform: translate(-3px, -1px); }
            60% { transform: translate(1px, 3px); }
            80% { transform: translate(3px, -1px); }
            100% { transform: translate(0); }
        }

        .search-input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #1e1e1e;
            padding: 15px 20px;
            border-top: 1px solid #333;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            max-width: 500px;
            padding: 12px 15px;
            border-radius: 25px;
            border: 1px solid var(--input-border);
            background-color: var(--input-bg);
            color: var(--text-color);
            font-family: 'Kosugi Maru', sans-serif;
            outline: none;
        }

        .search-input:focus {
            border-color: var(--accent-color);
        }

        .search-result-count {
            color: var(--accent-color);
            font-family: 'M PLUS 1p', sans-serif;
            font-weight: 900;
            white-space: nowrap;
        }

        .mode-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #333;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .mode-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--accent-color);
        }

        .highlight {
            background-color: var(--highlight-bg);
            color: var(--highlight-text);
            padding: 0 2px;
            border-radius: 2px;
            font-weight: bold;
            box-shadow: 0 0 4px 1px rgba(255, 235, 59, 0.5);
        }

        @media (max-width: 768px) {
            .diary-container {
                padding: 10px;
            }

            .entry-card {
                padding: 15px;
            }

            .terminal-title {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="terminal-header">
        <div class="terminal-dots">
            <div class="terminal-dot dot-red"></div>
            <div class="terminal-dot dot-yellow"></div>
            <div class="terminal-dot dot-green"></div>
        </div>
        <div class="terminal-title">GOJIROMA.DIARY > _</div>
    </div>

    <div class="diary-container" id="diaryContainer"></div>

    <div class="search-input-container">
        <input type="text" class="search-input" id="searchInput" placeholder="絞り込みキーワードを入力">
        <div class="search-result-count" id="searchResultCount"></div>
    </div>

    <div class="mode-indicator" id="modeIndicator">
        <div class="mode-dot"></div>
        <span>NORMAL</span>
    </div>

    <script>
        let isFakeMode = false;
        let diaryEntries = [];

        const formatDate = (yyyymmdd) => {
            const year = yyyymmdd.substring(0, 4);
            const month = yyyymmdd.substring(4, 6);
            const day = yyyymmdd.substring(6, 8);
            return `${year}/${month}/${day}`;
        };

        const loadDiaryEntries = async (filename = 'entry.md') => {
            try {
                const response = await fetch(filename);
                if (!response.ok) throw new Error('日記データの読み込みに失敗');

                const text = await response.text();
                const entries = text.split('---').filter(entry => entry.trim());
                const container = document.getElementById('diaryContainer');
                container.innerHTML = '';
                diaryEntries = [];

                entries.reverse().forEach(entry => {
                    const dateMatch = entry.match(/date:\s*(.*)/);
                    const contentMatch = entry.match(/content:\s*\|\n([\s\S]*?)(?=\n---|\n$)/m);

                    if (!dateMatch || !contentMatch) return;

                    const yyyymmdd = dateMatch[1].trim();
                    const contentLines = contentMatch[1]
                        .split('\n')
                        .map(line => line.replace(/^\s*\|?\s*/, ''))
                        .join('\n')
                        .trim();

                    const entryElement = document.createElement('div');
                    entryElement.className = 'entry-card';
                    entryElement.id = yyyymmdd;

                    const dateElement = document.createElement('div');
                    dateElement.className = 'entry-header';
                    dateElement.innerHTML = `
                        <div class="entry-date glitch-effect" data-text="${formatDate(yyyymmdd)}">
                            ${formatDate(yyyymmdd)}
                        </div>
                    `;

                    const contentElement = document.createElement('div');
                    contentElement.className = 'entry-content';
                    contentElement.textContent = contentLines;

                    entryElement.appendChild(dateElement);
                    entryElement.appendChild(contentElement);
                    container.appendChild(entryElement);

                    diaryEntries.push({
                        yyyymmdd,
                        content: contentLines,
                        date: formatDate(yyyymmdd),
                        element: entryElement
                    });
                });

                scrollToHashEntry();

            } catch (error) {
                showErrorState();
            }
        };

        const showErrorState = () => {
            const container = document.getElementById('diaryContainer');
            container.innerHTML = `
                <div class="entry-card">
                    <div class="entry-header">
                        <div class="entry-date glitch-effect" data-text="ERROR">
                            ERROR
                        </div>
                    </div>
                    <div class="entry-content">
                        日記データの読み込み中にエラーが発生。
                        ファイルが存在しないか、ネットワーク接続に問題あり。
                    </div>
                </div>
            `;
        };

        const scrollToHashEntry = () => {
            const hash = window.location.hash.substring(1);
            if (hash && hash.match(/^\d{8}$/)) {
                const entry = document.getElementById(hash);
                if (entry) {
                    entry.scrollIntoView({ behavior: 'smooth' });
                    entry.style.boxShadow = '0 0 0 2px var(--accent-color)';
                    setTimeout(() => {
                        entry.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.3)';
                    }, 2000);
                }
            }
        };

        const toggleMode = () => {
            isFakeMode = !isFakeMode;
            const modeIndicator = document.getElementById('modeIndicator');
            const modeText = modeIndicator.querySelector('span');
            const modeDot = modeIndicator.querySelector('.mode-dot');

            if (isFakeMode) {
                modeText.textContent = 'FAKE';
                modeDot.style.backgroundColor = 'var(--error-color)';
                document.documentElement.style.setProperty('--accent-color', '#cf6679');
                loadDiaryEntries('fake.md');
            } else {
                modeText.textContent = 'NORMAL';
                modeDot.style.backgroundColor = '#bb86fc';
                document.documentElement.style.setProperty('--accent-color', '#bb86fc');
                loadDiaryEntries('entry.md');
            }
        };

        const searchDiary = (term) => {
            const searchResultCount = document.getElementById('searchResultCount');
            if (!term) {
                searchResultCount.textContent = '';
                diaryEntries.forEach(entry => {
                    entry.element.classList.remove('hidden');
                    const contentElement = entry.element.querySelector('.entry-content');
                    contentElement.innerHTML = contentElement.textContent;
                });
                return;
            }

            const regex = new RegExp(term, 'gi');
            let matchCount = 0;

            diaryEntries.forEach(entry => {
                const contentElement = entry.element.querySelector('.entry-content');
                const originalText = contentElement.textContent;
                let highlightedText = originalText;

                const matches = originalText.match(regex);
                if (matches) {
                    matchCount += matches.length;
                    highlightedText = originalText.replace(regex, match => `<span class="highlight">${match}</span>`);
                    entry.element.classList.remove('hidden');
                } else {
                    entry.element.classList.add('hidden');
                }

                contentElement.innerHTML = highlightedText;
            });

            if (matchCount > 0) {
                searchResultCount.textContent = `${matchCount}件の一致`;
            } else {
                searchResultCount.textContent = "一致なし";
            }
        };

        document.getElementById('searchInput').addEventListener('input', (e) => {
            searchDiary(e.target.value);
        });

        document.getElementById('modeIndicator').addEventListener('click', toggleMode);

        window.addEventListener('load', () => {
            loadDiaryEntries();
            window.addEventListener('hashchange', scrollToHashEntry);
        });
    </script>
</body>
</html>
